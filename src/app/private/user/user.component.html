<div class="min-h-[calc(100vh-88px)] bg-white">
  
  <!-- Header -->
  <div class="bg-primary p-6 pb-16">
    <div class="max-w-2xl mx-auto text-center">
      <h2 class="text-2xl font-bold text-black font-outfit">
        @if (id) { Editar Usuario } @else { Nuevo Usuario }
      </h2>
      <p class="text-sm text-black/70 font-outfit mt-1">
        @if (id) { Modifica los datos del usuario } @else { Completa el formulario para crear un usuario }
      </p>
    </div>
  </div>
  
  <!-- Avatar flotante -->
  <div class="flex justify-center -mt-12 mb-6">
    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        @if (id) {
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        } @else {
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <line x1="19" y1="8" x2="19" y2="14"/>
          <line x1="22" y1="11" x2="16" y2="11"/>
        }
      </svg>
    </div>
  </div>

  <!-- Formulario -->
  <form [formGroup]="formulario" (ngSubmit)="save()" class="max-w-2xl mx-auto px-6 pb-6 space-y-5">
    
    <!-- Campo Nombre -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-outfit font-semibold text-gray-custom">Nombre completo</span>
      </label>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-custom" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <input type="text" 
               formControlName="name"
               placeholder="Ingresa el nombre"
               class="input input-bordered w-full pl-12 font-outfit bg-gray-light focus:border-primary focus:outline-none"
               [ngClass]="{'input-error border-secondary': formulario.get('name')?.invalid && formulario.get('name')?.touched}">
      </div>
      @if (formulario.get('name')?.invalid && formulario.get('name')?.touched) {
        <label class="label">
          <span class="label-text-alt text-secondary font-outfit">Campo requerido</span>
        </label>
      }
    </div>

    <!-- Campo Telefono -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-outfit font-semibold text-gray-custom">Teléfono</span>
      </label>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-custom" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
        </div>
        <input type="tel" 
               formControlName="phone"
               placeholder="Ingresa el teléfono"
               class="input input-bordered w-full pl-12 font-outfit bg-gray-light focus:border-primary focus:outline-none">
      </div>
    </div>

    <!-- Campo Contraseña -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-outfit font-semibold text-gray-custom">Contraseña</span>
        @if (id) {
          <span class="label-text-alt text-gray-custom font-outfit">Ingrese nueva o anterior</span>
        }
      </label>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-custom" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
        </div>
        <input type="password" 
               formControlName="password"
               placeholder="Ingresa la contraseña"
               class="input input-bordered w-full pl-12 font-outfit bg-gray-light focus:border-primary focus:outline-none"
               [ngClass]="{'input-error border-secondary': formulario.get('password')?.invalid && formulario.get('password')?.touched}">
      </div>
      @if (formulario.get('password')?.invalid && formulario.get('password')?.touched) {
        <label class="label">
          <span class="label-text-alt text-secondary font-outfit">Campo requerido</span>
        </label>
      }
    </div>

    <!-- Campo Rol -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-outfit font-semibold text-gray-custom">Rol del usuario</span>
      </label>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-custom" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
        </div>
        <select formControlName="rol" 
                class="select select-bordered w-full pl-12 font-outfit bg-gray-light focus:border-primary focus:outline-none"
                [ngClass]="{'select-error border-secondary': formulario.get('rol')?.invalid && formulario.get('rol')?.touched}">
          <option [ngValue]="null" disabled>Selecciona un rol</option>
          @for (rol of roles; track $index) {
            <option [ngValue]="rol.value">{{ rol.name | titlecase }}</option>
          }
        </select>
      </div>
      @if (formulario.get('rol')?.invalid && formulario.get('rol')?.touched) {
        <label class="label">
          <span class="label-text-alt text-secondary font-outfit">Debes seleccionar un rol</span>
        </label>
      }
    </div>

    <!-- Botones de accion -->
    <div class="flex flex-col-reverse sm:flex-row gap-3 pt-4">
      @if (id) {
        <button type="button" 
                (click)="deleteUser()"
                class="btn bg-secondary hover:bg-secondary/80 text-white border-none flex-1 font-outfit">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          Eliminar Usuario
        </button>
      }
      <button type="submit" 
              class="btn bg-primary hover:bg-primary-hover text-black border-none flex-1 font-outfit font-semibold">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
          <polyline points="17 21 17 13 7 13 7 21"/>
          <polyline points="7 3 7 8 15 8"/>
        </svg>
        @if (id) { Guardar Cambios } @else { Crear Usuario }
      </button>
    </div>

    <!-- Link para volver -->
    <div class="text-center pt-2">
      <a routerLink="/private/user-view" class="text-gray-custom hover:text-primary transition-colors text-sm font-outfit">
         Volver a la lista de usuarios
      </a>
    </div>
  </form>
</div>
