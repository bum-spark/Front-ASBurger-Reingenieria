<div class="flex h-[calc(100vh-88px)]" [formGroup]="_order.formOrder">
  
  <!-- Productos-->
  <div class="flex-1 overflow-y-auto pr-4">
    
    <!-- SECCION HAMBURGUESAS -->
    <section class="mb-8">
      <div class="mb-4">
        <h2 class="text-2xl font-bold text-black font-outfit">Hamburguesas</h2>
        <p class="text-sm text-gray-custom font-outfit">
          Todas las hamburguesas contienen jamón, queso, tocino, jitomate, cebolla, aguacate, lechuga, mayonesa y mostaza
        </p>
        <p class="text-xs text-gray-custom font-outfit mt-1">Acompañadas de papas a la francesa</p>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        @for (product of filterByCategory('da99cc44-03a0-457a-8711-4660c3b5b45b'); track product.idproducts) {
          <div class="card bg-white border border-border rounded-2xl p-4 flex flex-col items-center text-center hover:shadow-lg transition-shadow">
            <img src="../../../assets/Hamburguesa.png" alt="Hamburguesa" class="w-16 h-16 object-contain mb-3">
            <h4 class="text-sm font-semibold text-black font-outfit mb-1">{{ product.name }}</h4>
            <p class="text-xs text-gray-custom font-outfit mb-2 line-clamp-2">{{ product.description }}</p>
            <span class="text-lg font-bold text-secondary font-outfit mb-3">{{ product.price | currency }}</span>
            
            <!-- Control de cantidad -->
            <div class="flex items-center gap-2 bg-gray-light rounded-xl p-1" 
                 [ngClass]="{'ring-2 ring-primary shadow-lg': amount(product.idproducts) > 0}">
              <button type="button"
                      (click)="removeProduct(product.idproducts)"
                      class="btn btn-circle btn-sm bg-white border-border hover:bg-secondary hover:text-white hover:border-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14"/>
                </svg>
              </button>
              <span class="w-8 text-center font-bold font-outfit">{{ amount(product.idproducts) }}</span>
              <button type="button"
                      (click)="addProduct(product.idproducts, product.price, product.name, product.name_category)"
                      class="btn btn-circle btn-sm bg-primary border-primary hover:bg-primary-hover text-black">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>
    </section>

    <!-- SECCION ALITAS -->
    <section class="mb-8">
      <div class="mb-4">
        <h2 class="text-2xl font-bold text-black font-outfit">Alitas</h2>
        <p class="text-sm text-gray-custom font-outfit">La orden de alitas contiene 5 piezas</p>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        @for (product of filterByCategory('64afaea8-be6c-49ae-8e99-32132dd89630'); track product.idproducts) {
          <div class="card bg-white border border-border rounded-2xl p-4 flex flex-col items-center text-center hover:shadow-lg transition-shadow">
            <img src="../../../assets/Alitas.png" alt="Alitas" class="w-16 h-16 object-contain mb-3">
            <h4 class="text-sm font-semibold text-black font-outfit mb-1">{{ product.name }}</h4>
            <p class="text-xs text-gray-custom font-outfit mb-2 line-clamp-2">{{ product.description }}</p>
            <span class="text-lg font-bold text-secondary font-outfit mb-3">{{ product.price | currency }}</span>
            
            <!-- Control de cantidad -->
            <div class="flex items-center gap-2 bg-gray-light rounded-xl p-1"
                 [ngClass]="{'ring-2 ring-primary shadow-lg': amount(product.idproducts) > 0}">
              <button type="button"
                      (click)="removeProduct(product.idproducts)"
                      class="btn btn-circle btn-sm bg-white border-border hover:bg-secondary hover:text-white hover:border-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14"/>
                </svg>
              </button>
              <span class="w-8 text-center font-bold font-outfit">{{ amount(product.idproducts) }}</span>
              <button type="button"
                      (click)="addProduct(product.idproducts, product.price, product.name, product.name_category)"
                      class="btn btn-circle btn-sm bg-primary border-primary hover:bg-primary-hover text-black">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>
    </section>

    <!-- SECCION SNACKS -->
    <section class="mb-8">
      <div class="mb-4">
        <h2 class="text-2xl font-bold text-black font-outfit">Snacks</h2>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        @for (product of filterByCategory('4716bb4e-0793-4c76-9b48-3dd8e7a9ba9a'); track product.idproducts) {
          <div class="card bg-white border border-border rounded-2xl p-4 flex flex-col items-center text-center hover:shadow-lg transition-shadow">
            <img [src]="'../../../assets/' + product.name + '.png'" 
                 (error)="$any($event.target).src='../../../assets/Snack.png'"
                 alt="Snack" class="w-16 h-16 object-contain mb-3">
            <h4 class="text-sm font-semibold text-black font-outfit mb-1">{{ product.name }}</h4>
            <p class="text-xs text-gray-custom font-outfit mb-2 line-clamp-2">{{ product.description }}</p>
            <span class="text-lg font-bold text-secondary font-outfit mb-3">{{ product.price | currency }}</span>
            
            <!-- Control de cantidad -->
            <div class="flex items-center gap-2 bg-gray-light rounded-xl p-1"
                 [ngClass]="{'ring-2 ring-primary shadow-lg': amount(product.idproducts) > 0}">
              <button type="button"
                      (click)="removeProduct(product.idproducts)"
                      class="btn btn-circle btn-sm bg-white border-border hover:bg-secondary hover:text-white hover:border-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14"/>
                </svg>
              </button>
              <span class="w-8 text-center font-bold font-outfit">{{ amount(product.idproducts) }}</span>
              <button type="button"
                      (click)="addProduct(product.idproducts, product.price, product.name, product.name_category)"
                      class="btn btn-circle btn-sm bg-primary border-primary hover:bg-primary-hover text-black">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>
    </section>
    
  </div>

  <!-- Carrito/Personalizacion-->
  @if(orderDetailsArray().controls.length > 0 && !orderEmpty()) {
    <aside class="w-96 bg-white border-l border-border flex flex-col h-full">
      
      <!-- Header del carrito -->
      <div class="p-4 border-b border-border">
        <h3 class="text-lg font-bold text-black font-outfit flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="text-primary">
            <path d="M8 16L16.7201 15.2733C19.4486 15.046 20.0611 14.45 20.3635 11.7289L21 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
            <circle cx="6" cy="20" r="2" stroke="currentColor" stroke-width="1.5" />
            <circle cx="17" cy="20" r="2" stroke="currentColor" stroke-width="1.5" />
            <path d="M8 20L15 20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
            <path d="M2 2H2.966C3.91068 2 4.73414 2.62459 4.96326 3.51493L7.93852 15.0765C8.08887 15.6608 7.9602 16.2797 7.58824 16.7616L6.63213 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
          </svg>
          Tu Orden
        </h3>
        <p class="text-sm text-gray-custom font-outfit">{{ orderDetailsArray().controls.length }} producto(s)</p>
      </div>
      
      <!-- Lista de productos en el carrito -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4" formArrayName="order_details">
        @for (product of orderDetailsArray().controls; track product; let productindex = $index) {
          <div class="bg-gray-light rounded-2xl p-4">
            <!-- Info del producto -->
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold text-black font-outfit">
                {{ filterByProduct(product.value.products_idproducts)?.name }}
              </h4>
              <span class="badge bg-primary text-black font-outfit">x{{ product.value.amount }}</span>
            </div>
            
            <!-- Excepciones (ingredientes a quitar) -->
            @if (filterByIngredient('required', 0, filterByProduct(product.value.products_idproducts)?.ingredients, product.value.products_idproducts, product.value.amount)?.length) {
              <div class="mb-3">
                <p class="text-xs font-semibold text-gray-custom font-outfit uppercase mb-2">Sin (Excepciones)</p>
                <div class="flex flex-wrap gap-2">
                  @for (ingredient of filterByIngredient('required', 0, filterByProduct(product.value.products_idproducts)?.ingredients, product.value.products_idproducts, product.value.amount); track ingredient.idingredients) {
                    <label class="cursor-pointer">
                      <input type="checkbox" 
                             class="hidden peer"
                             [checked]="ingredientsSelected(productindex, 0, ingredient.name)"
                             (change)="addIngredient(product.value.products_idproducts, ingredient.idingredients, 0, !ingredientsSelected(productindex, 0, ingredient.name), product.value.amount, ingredient.name, 0)">
                      <div class="flex flex-col items-center p-2 rounded-xl border-2 border-transparent peer-checked:border-secondary peer-checked:bg-secondary/10 hover:bg-white transition-all">
                        <img [src]="'../../../assets/' + ingredient.name + '.png'" 
                             alt="{{ ingredient.name }}" 
                             class="w-10 h-10 object-contain">
                        <span class="text-xs font-outfit mt-1">{{ ingredient.name }}</span>
                      </div>
                    </label>
                  }
                </div>
              </div>
            }
            
            <!-- Extras (ingredientes adicionales) -->
            @if (filterByIngredient('extra', 1, filterByProduct(product.value.products_idproducts)?.ingredients, product.value.products_idproducts, product.value.amount)?.length) {
              <div class="mb-3">
                <p class="text-xs font-semibold text-gray-custom font-outfit uppercase mb-2">Extras</p>
                <div class="flex flex-wrap gap-2">
                  @for (ingredient of filterByIngredient('extra', 1, filterByProduct(product.value.products_idproducts)?.ingredients, product.value.products_idproducts, product.value.amount); track ingredient.idingredients) {
                    <label class="cursor-pointer">
                      <input type="checkbox" 
                             class="hidden peer"
                             [checked]="ingredientsSelected(productindex, 1, ingredient.name)"
                             (change)="addIngredient(product.value.products_idproducts, ingredient.idingredients, 1, !ingredientsSelected(productindex, 1, ingredient.name), product.value.amount, ingredient.name, ingredient.cost)">
                      <div class="flex flex-col items-center p-2 rounded-xl border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/20 hover:bg-white transition-all">
                        <img [src]="'../../../assets/' + ingredient.name + '.png'" 
                             alt="{{ ingredient.name }}" 
                             class="w-10 h-10 object-contain">
                        <span class="text-xs font-outfit mt-1">{{ ingredient.name }}</span>
                        <span class="text-xs font-outfit text-secondary font-semibold">{{ ingredient.cost | currency }}</span>
                      </div>
                    </label>
                  }
                </div>
              </div>
            }
            
            <!-- Comentarios -->
            <div [formGroupName]="productindex">
              <textarea formControlName="comments"
                        rows="2"
                        placeholder="Comentarios especiales..."
                        class="textarea textarea-bordered w-full font-outfit text-sm bg-white resize-none focus:border-primary focus:outline-none">
              </textarea>
            </div>
          </div>
        }
      </div>
      
      <!-- Footer con boton -->
      <div class="p-4 border-t border-border">
        <button [routerLink]="['/private/order-view']"
                class="btn w-full bg-primary hover:bg-primary-hover text-black font-outfit font-semibold gap-2 border-none">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          Continuar con la orden
        </button>
      </div>
      
    </aside>
  }
  
  <!-- Boton flotante cuando no hay sidebar visible -->
  @if(orderDetailsArray().controls.length > 0 && !orderEmpty()) {
  } @else {
    <!-- Estado vacio  -->
    <aside class="w-80 bg-white border-l border-border flex flex-col items-center justify-center h-full p-6 text-center">
      <div class="w-24 h-24 bg-gray-light rounded-full flex items-center justify-center mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="none" class="text-gray-custom">
          <path d="M8 16L16.7201 15.2733C19.4486 15.046 20.0611 14.45 20.3635 11.7289L21 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
          <circle cx="6" cy="20" r="2" stroke="currentColor" stroke-width="1.5" />
          <circle cx="17" cy="20" r="2" stroke="currentColor" stroke-width="1.5" />
          <path d="M8 20L15 20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
          <path d="M2 2H2.966C3.91068 2 4.73414 2.62459 4.96326 3.51493L7.93852 15.0765C8.08887 15.6608 7.9602 16.2797 7.58824 16.7616L6.63213 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
        </svg>
      </div>
      <h3 class="text-lg font-bold text-black font-outfit mb-2">Tu carrito está vacío</h3>
      <p class="text-sm text-gray-custom font-outfit">Agrega productos del menú para comenzar tu orden</p>
    </aside>
  }
  
</div>
